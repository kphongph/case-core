<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="form-card.html">

<polymer-element name="form-list" attributes="ownerid active">
  <template>
    <style>
    :host {
      display: none;
      width: 100%;
      height:100%;
    }
    :host([active]) {
      display: block;
    }
    .result {
      margin-bottom:15px;
      padding:10px;
    }
    </style>

    <core-ajax id="ajaxLoadForm"
      on-core-response="{{formLoaded}}"
      handleAs="json">
    </core-ajax>

    <div layout vertical start>
     <template repeat="{{form in forms}}">
      <form-card docid="{{form.id}}">
       <h2>{{form.name}}</h2>
       {{form.createdDate}}
      </form-card>
     </template>
    </div>

  </template>
  
  <script>

  Polymer('form-list',{
    created: function() {
      this.forms = [];
    },
    ready: function() {
    },
    toggle: function() {
      this.active =!this.active;
      console.log('toggle',this.active);
      if(this.active) {
        this.$.ajaxLoadForm.go();
      }
    },
    owneridChanged: function(oldVal, newVal) {
      var query = "../api/people/"+newVal+"/forms";
      query +="?filter[fields][id]=true";
      query +="&filter[fields][name]=true";
      this.$.ajaxLoadForm.url = query;
      if(this.active) {
        this.$.ajaxLoadForm.go();
      }
    },
    formLoaded: function() {
      this.forms = this.$.ajaxLoadForm.response;
    }
  });
  </script>
</polymer-element>
