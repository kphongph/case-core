<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/core-icon/core-icon.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-list/core-list.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">

<polymer-element name="ltc-people">

<template>
  <link rel="stylesheet" href="ltc-people.css">

  <core-ajax id="searchAjax" handleAs="json" 
    on-core-response="{{handleResponse}}"> 
  </core-ajax>
  
  <div vertical layout>
    <div horizontal center layout>
      <core-icon icon="search"></core-icon>
      <paper-input label="รหัสบัตรประชาชน" 
         flex value="{{query}}">
      </paper-input>
    </div>
    <div>
      <paper-spinner class="blue" active?="{{loading}}">
      </paper-spinner>
    </div>
    <div horizontal layout wrap>
      <template repeat="{{model in people}}">
        <paper-shadow z="1" class="item" layout vertical>
          <div>{{model.CID}}</div> 
          <div>{{model.FirstName}} {{model.LastName}}</div>
        </paper-shadow>
      </template>
    </div>
  </div>
  
</template>

<script>
  Polymer('ltc-people', {
    loading:false,
    ready : function() {
      this.ajax = this.$.searchAjax;
    },
    queryChanged : function(oldVal, newVal) {
      var query = {where:{CID:{like:newVal}},limit:20};
      query['fields'] = {CID:true,FirstName:true,LastName:true};
      this.ajax.url = '../api/people?filter='+JSON.stringify(query);
      this.loading=true;
      this.ajax.go();
    },
    handleResponse : function() {
      this.loading=false;
      if(this.ajax.response) {
        this.people = this.ajax.response;
      }
    },
    test: function(e,obj) {
      console.log(e);
    }
  });
</script>
</polymer>
