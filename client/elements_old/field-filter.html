<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/font-roboto/roboto.html">

<dom-module id="field-filter">
  <style>
    .container{
      font-family: 'Roboto Regular', sans-serif;
      @apply(--layout-horizontal);
      padding-top: 20px;
    }
    .title{
      font-weight: bold;
      font-size: 100%;
    }
    .list{
      margin-left: 15px;
    }
  </style>
  <template>
    <div class="container">
      <div class="title">Fields</div>
      <div class="list" id="checkboxList">
        <template is="dom-repeat" items="{{fields}}">
          <paper-checkbox on-change="_handleChecked" checked>{{item}}</paper-checkbox>
        </template>
      </div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'field-filter',
    properties: {
      fields : {
        type: Array
      }
    },
    ready: function() {
    },
    _handleChecked: function(e){
      var selected = e.target.innerText.substr(1).trim();
      var index = this.fields.indexOf(selected);
      if(e.target.checked){
        if(index == -1){
          this.fields.push(selected);
        }
      } else {
        if(index != -1){
          this.fields.splice(index, 1);
        }
      }
      this.fire('filter', this.fields);
    },
    doJob: function(job){
      var cbList = Polymer.dom(this.$.checkboxList).querySelectorAll('paper-checkbox');
      for(var i = 0; i < cbList.length; i++){
        if(cbList[i].innerText.trim().toLowerCase() == job.value.field.toLowerCase()){
          cbList[i].checked = false;
          cbList[i].fire('change');
          break;
        }
      }
    }
  });
</script>
